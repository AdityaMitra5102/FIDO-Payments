<!DOCTYPE html>
<html lang="zxx">

  <head>
    <meta charset="utf-8">
    <title>NFC - FIDO Payments</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
    <script src="/cbor.js"></script>
    <!-- mobile responsive meta -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- ** Plugins Needed for the Project ** -->
    <!-- Bootstrap -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/bootstrap.min.css">
    <!-- themefy-icon -->
    <link rel="stylesheet" href="assets/plugins/themify-icons/themify-icons.css">
    <!-- slick slider -->
    <link rel="stylesheet" href="assets/plugins/slick/slick.css">
    <!-- venobox popup -->
    <link rel="stylesheet" href="assets/plugins/Venobox/venobox.css">
    <!-- aos -->
    <link rel="stylesheet" href="assets/plugins/aos/aos.css">

    <!-- Main Stylesheet -->
    <link href="assets/css/style.css" rel="stylesheet">

    <!--Favicon-->
    <link rel="shortcut icon" href="assets/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="assets/images/favicon.ico" type="image/x-icon">

  </head>

  <body>


    <!-- navigation -->
    <section class="fixed-top navigation b-white">
      <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light">
          <a class="navbar-brand" href="/">
            <h3>FIDO Payments</h3>
          </a>
          <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navbar"
            aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <!-- navbar -->
          <div class="collapse navbar-collapse text-center" id="navbar">
            <ul class="navbar-nav ml-auto">
              <!-- <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link page-scroll" href="#feature">Feature</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#">About</a>
                  </li> -->
              <li class="nav-item">
                <a class="nav-link" href="#">Service</a>
              </li>
              <li class="nav-item">
                <a class="nav-link page-scroll" href="/inittagread">Receive money</a>
              </li>
              <li class="nav-item">
                <a class="nav-link page-scroll" href="/clearcookies">Clear Username</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/inintlogin">Login</a>
              </li>
            </ul>
            <a class="btn btn-primary ml-lg-3 primary-shadow" href="/signup">Sign Up</a></a>
          </div>
        </nav>
      </div>
    </section>
    <!-- /navigation -->
    <!-- about us -->
    <section class="section-lg about pb-0">
      <div class="container">
        <div class="row">
          <div class="col-lg-12">
            <h2 class="section-title">Transaction</h2>
          </div>
          <div class="row contact-bg p-5 rounded mb-5 ">
            <div class="col-lg-7 mb-4 mb-lg-0">
              <h1>Transaction</h1>
              <div {{writebuttonparam}} id="qrcode" style="width:300px; height:300px; margin-top:15px;"
                class="btn btn-lg"></div>
              <br>

            </div>
            <div class="col-lg-5">
              <button class="btn btn-primary m-2" id="scanButton" {{scanbuttonparam}}>Scan NFC</button>
              <button class="btn btn-primary m-2" id="writeButton" {{writebuttonparam}}>Write to NFC</button>
              <button class="btn btn-primary m-2" id="shareButton" {{writebuttonparam}}>Share</button>

            </div>
          </div>
        </div>
      </div>
      <!-- background shapes -->
      <img src="assets/images/background-shape/green-dot.png" alt="background-shape"
        class="about-bg-1 up-down-animation" />
      <img src="assets/images/background-shape/blue-dot.png" alt="background-shape"
        class="about-bg-2 left-right-animation" />
      <img src="assets/images/background-shape/green-half-cycle.png" alt="background-shape"
        class="about-bg-3 up-down-animation" />
      <img src="assets/images/background-shape/seo-ball-1.png" alt="background-shape"
        class="about-bg-4 left-right-animation" />
      <img src="assets/images/background-shape/team-bg-triangle.png" alt="background-shape"
        class="about-bg-5 up-down-animation" />
      <img src="assets/images/background-shape/service-half-cycle.png" alt="background-shape"
        class="about-bg-6 left-right-animation" />
    </section>
    <!-- /about us -->





    <!-- footer -->
    <footer class="footer-section footer" style="background-image: url(images/backgrounds/footer-bg.png);">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0">
            <!-- logo -->
            <a href="index.html">
              <img class="img-fluid" src="assets/images/logo.png" alt="logo">
            </a>
          </div>
          <!-- footer menu -->
          <nav class="col-lg-8 align-self-center mb-5">
            <ul class="list-inline text-lg-right text-center footer-menu">
              <li class="list-inline-item active"><a href="index.html">Home</a></li>
              <li class="list-inline-item"><a class="page-scroll" href="#feature">Feature</a></li>
              <li class="list-inline-item"><a href="about.html">About</a></li>
              <li class="list-inline-item"><a class="page-scroll" href="#team">Team</a></li>
              <li class="list-inline-item"><a class="page-scroll" href="#pricing">Pricing</a></li>
              <li class="list-inline-item"><a href="contact.html">Contact</a></li>
            </ul>
          </nav>
          <!-- footer social icon -->
          <nav class="col-12">
            <ul class="list-inline text-lg-right text-center social-icon">
              <li class="list-inline-item">
                <a class="facebook" href="#"><i class="ti-facebook"></i></a>
              </li>
              <li class="list-inline-item">
                <a class="twitter" href="#"><i class="ti-twitter-alt"></i></a>
              </li>
              <li class="list-inline-item">
                <a class="linkedin" href="#"><i class="ti-linkedin"></i></a>
              </li>
              <li class="list-inline-item">
                <a class="black" href="#"><i class="ti-github"></i></a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </footer>
    <!-- /footer -->

    <!-- jQuery -->
    <script hrefsrc="assets /plugins/jQuery/jquery.min.js">
    </script>
    <!-- Bootstrap JS -->
    <script src="assets /plugins/bootstrap/bootstrap.min.js">
    </script>
    <!-- slick slider -->
    <script src="assets /plugins/slick/slick.min.js">
    </script>
    <!-- venobox -->
    <script src="assets /plugins/Venobox/venobox.min.js">
    </script>
    <!-- aos -->
    <script src="assets /plugins/aos/aos.js">
    </script>
    <!-- Main Script -->
    <script src="assets/js/script.js"></script>


    <script>
      log = console.log;

      if (!("NDEFReader" in window))
        console.log(
          "Web NFC is not available.\n" +
          'Please make sure the "Experimental Web Platform features" flag is enabled on Android.'
        );
    </script>

    <script>
      scanButton.addEventListener("click", async () => {
        log("User clicked scan button");

        try {
          const ndef = new NDEFReader();
          await ndef.scan();
          log("> Scan started");

          ndef.addEventListener("readingerror", () => {
            log("Argh! Cannot read data from the NFC tag. Try another one?");
          });

          ndef.addEventListener("reading", ({ message, serialNumber }) => {
            log(`> Serial Number: ${ serialNumber }`);
            log(`> Records: (${ message.records.length })`);
            const decoder = new TextDecoder();
            for (const record of message.records) {
              const txt = decoder.decode(record.data);

              if (txt.startsWith("tag_")) {
                window.location.href = "/readtag?tagid=" + txt
              }
            }

          });
        } catch (error) {
          log("Argh! " + error);
        }
      });

      writeButton.addEventListener("click", async () => {
        log("User clicked write button");

        try {
          const ndef = new NDEFReader();
          await ndef.scan();
          log("> Scan started");

          ndef.addEventListener("readingerror", () => {
            log("Argh! Cannot read data from the NFC tag. Try another one?");
          });

          ndef.addEventListener("reading", ({ message, serialNumber }) => {
            log("Read");
          });
          await ndef.write("tag_{{token}}");

          setTimeout(function () {
            console.log("delay");
          }, 1000); //delay is in milliseconds 

          alert("Token written");
          window.location.href = "/";
        } catch (error) {
          alert("> Error");
          window.location.href = "/";
        }
      });

    </script>

    <script>
      const shareData = {
        title: 'Money transfer',
        url: 'https://{{url}}/readtag?tagid=tag_{{token}}'
      }
      shareButton.addEventListener('click', async () => {
        try {
          await navigator.share(shareData)
          window.location.href = "/";
        }
        catch (err) {
          alert("> Error");
          window.location.href = "/";
        }
      });
    </script>
    <script type="text/javascript">
      var qrcode = new QRCode(document.getElementById("qrcode"), {
        text: "https://{{url}}/readtag?tagid=tag_{{token}}",
        width: 250,
        height: 250,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
      });
    </script>
  </BODY>

</HTML>
